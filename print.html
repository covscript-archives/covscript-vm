<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Epoch Virtual Machine Specification</title>
        
        <meta name="robots" content="noindex" />
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="This is the specification of Epoch VM.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "light" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> Preface</a></li><li class="chapter-item expanded "><a href="binary_file/index.html"><strong aria-hidden="true">2.</strong> Binary File Format</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="binary_file/epoch_file_structure.html"><strong aria-hidden="true">2.1.</strong> Epoch File Structure</a></li><li class="chapter-item expanded "><a href="binary_file/constant_pool.html"><strong aria-hidden="true">2.2.</strong> Constant Pools</a></li><li class="chapter-item expanded "><a href="binary_file/field_and_struct.html"><strong aria-hidden="true">2.3.</strong> Field and Struct</a></li></ol></li><li class="chapter-item expanded "><a href="runtime/index.html"><strong aria-hidden="true">3.</strong> Runtime</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="runtime/reserved_names.html"><strong aria-hidden="true">3.1.</strong> Reserved Names</a></li></ol></li><li class="chapter-item expanded "><a href="instruction/index.html"><strong aria-hidden="true">4.</strong> Instruction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="instruction/00-format-description.html"><strong aria-hidden="true">4.1.</strong> Instruction Descriptions Format</a></li><li class="chapter-item expanded "><a href="instruction/array_load.html"><strong aria-hidden="true">4.2.</strong> array_load</a></li><li class="chapter-item expanded "><a href="instruction/array_load.html"><strong aria-hidden="true">4.3.</strong> array_load</a></li><li class="chapter-item expanded "><a href="instruction/array_store.html"><strong aria-hidden="true">4.4.</strong> array_store</a></li><li class="chapter-item expanded "><a href="instruction/const8.html"><strong aria-hidden="true">4.5.</strong> const8</a></li><li class="chapter-item expanded "><a href="instruction/const8_fast.html"><strong aria-hidden="true">4.6.</strong> const8_n</a></li><li class="chapter-item expanded "><a href="instruction/const32.html"><strong aria-hidden="true">4.7.</strong> const32</a></li><li class="chapter-item expanded "><a href="instruction/const_null.html"><strong aria-hidden="true">4.8.</strong> const_null</a></li><li class="chapter-item expanded "><a href="instruction/const_num.html"><strong aria-hidden="true">4.9.</strong> const_num</a></li><li class="chapter-item expanded "><a href="instruction/const_string.html"><strong aria-hidden="true">4.10.</strong> const_string</a></li><li class="chapter-item expanded "><a href="instruction/dup.html"><strong aria-hidden="true">4.11.</strong> dup</a></li><li class="chapter-item expanded "><a href="instruction/field_load.html"><strong aria-hidden="true">4.12.</strong> field_load</a></li><li class="chapter-item expanded "><a href="instruction/field_store.html"><strong aria-hidden="true">4.13.</strong> field_store</a></li><li class="chapter-item expanded "><a href="instruction/if_cmp.html"><strong aria-hidden="true">4.14.</strong> if_cmp</a></li><li class="chapter-item expanded "><a href="instruction/invoke.html"><strong aria-hidden="true">4.15.</strong> invoke</a></li><li class="chapter-item expanded "><a href="instruction/invoke_ctor.html"><strong aria-hidden="true">4.16.</strong> invoke_ctor</a></li><li class="chapter-item expanded "><a href="instruction/jump.html"><strong aria-hidden="true">4.17.</strong> jump</a></li><li class="chapter-item expanded "><a href="instruction/jump_cmp.html"><strong aria-hidden="true">4.18.</strong> jump_cmp</a></li><li class="chapter-item expanded "><a href="instruction/jump_null.html"><strong aria-hidden="true">4.19.</strong> jump_null</a></li><li class="chapter-item expanded "><a href="instruction/local_load.html"><strong aria-hidden="true">4.20.</strong> local_load</a></li><li class="chapter-item expanded "><a href="instruction/local_store.html"><strong aria-hidden="true">4.21.</strong> local_store</a></li><li class="chapter-item expanded "><a href="instruction/new.html"><strong aria-hidden="true">4.22.</strong> new</a></li><li class="chapter-item expanded "><a href="instruction/nop.html"><strong aria-hidden="true">4.23.</strong> nop</a></li><li class="chapter-item expanded "><a href="instruction/pop.html"><strong aria-hidden="true">4.24.</strong> pop</a></li><li class="chapter-item expanded "><a href="instruction/return.html"><strong aria-hidden="true">4.25.</strong> return</a></li><li class="chapter-item expanded "><a href="instruction/return_void.html"><strong aria-hidden="true">4.26.</strong> return_void</a></li><li class="chapter-item expanded "><a href="instruction/swap.html"><strong aria-hidden="true">4.27.</strong> swap</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Epoch Virtual Machine Specification</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#epoch-vm-specification" id="epoch-vm-specification">Epoch VM Specification</a></h1>
<p><strong>Version 1.0</strong></p>
<h3><a class="header" href="#license" id="license">License</a></h3>
<p>Epoch VM, all the source code, is released under the <a href="https://covariant.cn/licenses/LICENSE-1.0">the Covariant Innovation General Public License</a>.</p>
<p>This documentation is released under</p>
<p><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="CC" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br /><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC-BY-NC-SA 4.0</a>.</p>
<h1><a class="header" href="#binary-file-format" id="binary-file-format">Binary File Format</a></h1>
<p>In this chapter, we will standardize:</p>
<ul>
<li>Binary file header</li>
<li>Constant pools</li>
<li>Functions' binary representation</li>
<li>Structs' binary representation</li>
</ul>
<h2><a class="header" href="#file-type" id="file-type">File Type</a></h2>
<p>Epoch VM loads and executes <strong>epoch file</strong> (with the file extension <code>.epoch</code>).</p>
<p>An epoch class file consists of a stream of 8-bit bytes. All 16-bit, 32-bit, and 64-bit
quantities are constructed by reading in two, four, and eight consecutive 8-bit
bytes, respectively. Multibyte data items are always stored in <strong>big-endian order</strong>,
where the high bytes come first.</p>
<h2><a class="header" href="#conventions" id="conventions">Conventions</a></h2>
<p>This chapter defines its own set of data types representing class file data: The
types <code>u1</code>, <code>u2</code>, and <code>u4</code> represent an unsigned <code>one-</code>, <code>two-</code>, or <code>four-</code>byte quantity,
respectively.</p>
<p>In the C++ programming language, these data types are defined as:</p>
<pre><code class="language-cpp">using u1 = uint8_t;
using u2 = uint16_t;
using u4 = uint32_t;
</code></pre>
<p>This chapter presents the class file format using pseudo-structures written in a
C-like structure notation. To avoid confusion with the fields of classes and class
instances, etc., the contents of the structures describing the class file format are
referred to as items. Successive items are stored in the class file sequentially,
without padding or alignment.</p>
<p>Tables, consisting of zero or more variable-sized items, are used in several class
file structures. Although we use C-like array syntax to refer to table items, the fact
that tables are streams of varying-sized structures means that it is not possible to
translate a table index directly to a byte offset into the table.
Where we refer to a data structure as an array, it consists of zero or more contiguous
fixed-sized items and can be indexed like an array.</p>
<h1><a class="header" href="#epoch-file-structure" id="epoch-file-structure">Epoch File Structure</a></h1>
<p>An epoch file consists of a single <code>EpochFile</code> structure.</p>
<pre><code class="language-c">struct EpochFile {
    u4 magic;
    u4 version;

    u2 num_pool_count;
    NumInfo num_pool[num_pool_count];

    u2 string_pool_count;
    StringInfo string_pool[string_pool_count];

    u2 field_pool_count;
    FieldInfo field_pool[field_pool_count];

    u2 type_pool_count;
    TypeInfo type_pool[type_pool_count];

    u2 this_field_count;
    Field this_field[this_field_count];

    u2 this_struct_count;
    Struct this_struct[this_struct_count];
};
</code></pre>
<p>The items in the <code>EpochFile</code> structure are as follows:</p>
<h4><a class="header" href="#magic" id="magic">magic</a></h4>
<p>The <code>magic</code> item supplies the <code>magic</code> number identifying the class file format;
it has the value <code>0xCC114514</code>.</p>
<h4><a class="header" href="#version" id="version">version</a></h4>
<p>The value of <code>version</code> is the version number of this class file. Together, a version number determine the version of the class file format.</p>
<h4><a class="header" href="#num_pool_count" id="num_pool_count">num_pool_count</a></h4>
<p>The value of the <code>num_pool_count</code> item is equal to the number of entries in the <code>num_pool</code> table.
A <code>num_pool</code> index is considered valid if it is in the range <code>[0, num_pool_count)</code>.</p>
<h4><a class="header" href="#num_pool" id="num_pool">num_pool</a></h4>
<p>The <code>num_pool</code> is a table of structures representing various <strong>number constants</strong> that are referred to within the <code>EpochFile</code> structure and its substructures. The format of each <code>num_pool</code> table entry is described later in <a href="binary_file/constant_pool.html"><strong>Constant Pools</strong></a>.</p>
<p>The <code>num_pool</code> table is indexed from <code>0</code> to <code>num_pool_count - 1</code></p>
<h4><a class="header" href="#string_pool_count" id="string_pool_count">string_pool_count</a></h4>
<p>The value of the <code>string_pool_count</code> item is equal to the number of entries in the <code>string_pool</code> table.
A <code>string_pool</code> index is considered valid if it is in the range <code>[0, string_pool_count)</code>.</p>
<h4><a class="header" href="#string_pool" id="string_pool">string_pool</a></h4>
<p>The <code>string_pool</code> is a table of structures representing various <strong>string constants</strong> that are referred to within the <code>EpochFile</code> structure and its substructures. The format of each <code>string_pool</code> table entry is described later in <a href="binary_file/constant_pool.html"><strong>Constant Pools</strong></a>.</p>
<p>The <code>string_pool</code> table is indexed from <code>0</code> to <code>string_pool_count - 1</code></p>
<h4><a class="header" href="#field_pool_count" id="field_pool_count">field_pool_count</a></h4>
<p>The value of the <code>field_pool_count</code> item is equal to the number of entries in the <code>field_pool</code> table.
A <code>field_pool</code> index is considered valid if it is in the range <code>[0, field_pool_count)</code>.</p>
<h4><a class="header" href="#field_pool" id="field_pool">field_pool</a></h4>
<p>The <code>field_pool</code> is a table of structures representing various <strong>field constants</strong> that are referred to within the <code>EpochFile</code> structure and its substructures. The format of each <code>field_pool</code> table entry is described later in <a href="binary_file/constant_pool.html"><strong>Constant Pools</strong></a>.</p>
<p>The <code>field_pool</code> table is indexed from <code>0</code> to <code>field_pool_count - 1</code></p>
<h4><a class="header" href="#type_pool_count" id="type_pool_count">type_pool_count</a></h4>
<p>The value of the <code>type_pool_count</code> item is equal to the number of entries in the <code>type_pool</code> table.
A <code>type_pool</code> index is considered valid if it is in the range <code>[0, type_pool_count)</code>.</p>
<h4><a class="header" href="#type_pool" id="type_pool">type_pool</a></h4>
<p>The <code>type_pool</code> is a table of structures representing various <strong>type constants</strong> that are referred to within the <code>EpochFile</code> structure and its substructures. The format of each <code>type_pool</code> table entry is described later in <a href="binary_file/constant_pool.html"><strong>Constant Pools</strong></a>.</p>
<p>The <code>type_pool</code> table is indexed from <code>0</code> to <code>type_pool_count - 1</code></p>
<h4><a class="header" href="#this_field_count" id="this_field_count">this_field_count</a></h4>
<p>The value of the <code>this_field_count</code> item is equal to the number of entries in the <code>this_field</code> table.
A <code>this_field</code> index is considered valid if it is in the range <code>[0, this_field_count)</code>.</p>
<h4><a class="header" href="#this_field" id="this_field">this_field</a></h4>
<p>The <code>this_field</code> is a table of structures representing various field defined in this file. A <code>Field</code> can be a function or a variable. The format of <code>Field</code> structure is described later in <a href="binary_file/field_and_struct.html"><strong>Field and Struct</strong></a>.</p>
<p>The <code>this_field</code> table is indexed from <code>0</code> to <code>this_field_count - 1</code></p>
<h4><a class="header" href="#this_struct_count" id="this_struct_count">this_struct_count</a></h4>
<p>The value of the <code>this_struct_count</code> item is equal to the number of entries in the <code>this_struct</code> table.
A <code>this_struct</code> index is considered valid if it is in the range <code>[0, this_struct_count)</code>.</p>
<h4><a class="header" href="#this_struct" id="this_struct">this_struct</a></h4>
<p>The <code>this_struct</code> is a table of structures representing various field defined in this file. The format of <code>Struct</code> structure is described later in <a href="binary_file/field_and_struct.html"><strong>Field and Struct</strong></a>.</p>
<p>The <code>this_struct</code> table is indexed from <code>0</code> to <code>this_struct_count - 1</code></p>
<h1><a class="header" href="#constant-pool" id="constant-pool">Constant Pool</a></h1>
<h2><a class="header" href="#constant-number-pool" id="constant-number-pool">Constant Number Pool</a></h2>
<p>The <code>NumInfo</code> represent 8-byte numeric(double) constants:</p>
<pre><code class="language-c">struct NumInfo {
    u4 high_bytes;
    u4 low_bytes;
};
</code></pre>
<p>The items of these structures are as follows:</p>
<h4><a class="header" href="#high_bytes-low_bytes" id="high_bytes-low_bytes">high_bytes, low_bytes</a></h4>
<p>The <strong>unsigned</strong> <code>high_bytes</code> and <code>low_bytes</code> items of the <code>NumInfo</code>
structure together represent the <code>double</code> value in <em><strong>IEEE 754 floating-point</strong></em> double format. The bytes of each item are stored in big-endian (high byte first) order.</p>
<p>The value represented by the <code>NumInfo</code> structure is determined
as follows:</p>
<p>The <code>high_bytes</code> and <code>low_bytes</code> items are converted into the <code>long</code>
constant <code>bits</code>, which is equal to</p>
<pre><code class="language-c">long bits = ((long) high_bytes &lt;&lt; 32) + low_bytes;
</code></pre>
<p>Then:</p>
<ul>
<li>
<p>If <code>bits</code> is <code>0x7ff0000000000000L</code>, the double value will be positive infinity.</p>
</li>
<li>
<p>If <code>bits</code> is <code>0xfff0000000000000L</code>, the double value will be negative infinity.</p>
</li>
<li>
<p>If <code>bits</code> is in the range <code>0x7ff0000000000001L</code> through <code>0x7fffffffffffffffL</code> or in the range <code>0xfff0000000000001L</code> through <code>0xffffffffffffffffL</code>, the double value will be <code>NaN</code>.</p>
</li>
<li>
<p>In all other cases, let <code>s</code>, <code>e</code>, and <code>m</code> be three values that might be computed from <code>bits</code>:</p>
<pre><code class="language-c">int s = ((bits &gt;&gt; 63) == 0) ? 1 : -1;
int e = (int) ((bits &gt;&gt; 52) &amp; 0x7ffL);
long m = (e == 0)
       ? (bits &amp; 0xfffffffffffffL) &lt;&lt; 1
       : (bits &amp; 0xfffffffffffffL) | 0x10000000000000L;
</code></pre>
<p>Then the floating-point value equals the <code>double</code> value of the mathematical expression
$$s \times m \times {2}^{e-1075}$$
which is equivalent to the following code:</p>
<pre><code class="language-c">double value = s * m * pow(2, e - 1075);
</code></pre>
<p>where the <code>pow</code> is of type <code>(double, double) -&gt; double</code>.</p>
</li>
</ul>
<h2><a class="header" href="#constant-string-pool" id="constant-string-pool">Constant String Pool</a></h2>
<p>The <code>StringInfo</code> structure is used to represent constant string values:</p>
<pre><code class="language-c">struct StringInfo {
    u2 length;
    u1 bytes[length];
};
</code></pre>
<p>The items of the <code>StringInfo</code> structure are the following:</p>
<h4><a class="header" href="#length" id="length">length</a></h4>
<p>The value of the length item gives the number of bytes in the bytes array
(not the length of the resulting string). The strings in the <code>StringInfo</code>
structure are not null-terminated.</p>
<h4><a class="header" href="#bytes" id="bytes">bytes[]</a></h4>
<p>The bytes array contains the bytes of the string. No byte may have the value
<code>(u1) 0</code> or lie in the range <code>(u1) 0xf0</code> - <code>(u1) 0xff</code>.</p>
<h2><a class="header" href="#constant-field-info-pool-and-constant-type-info-pool" id="constant-field-info-pool-and-constant-type-info-pool">Constant Field Info Pool and Constant Type Info Pool</a></h2>
<p>Fields and Types are represented by similar structures:</p>
<pre><code class="language-c">struct FieldInfo {
    u2 name_index;
};

struct TypeInfo {
    u2 name_index;
};
</code></pre>
<p>The value of the <code>name_index</code> item must be a valid index into the <code>string_pool</code> table.
The <code>string_pool</code> entry at that index represents the field name or type name.</p>
<p>If the name of the field of a <code>FieldInfo</code> structure begins with a '&lt;' ('\u003c'),
then the name must be the special name <code>&lt;ctor&gt;</code>, representing a constructor method.
The return type of such a method must be void.</p>
<h1><a class="header" href="#field-and-struct" id="field-and-struct">Field and Struct</a></h1>
<h2><a class="header" href="#field" id="field">Field</a></h2>
<p>A <code>Field</code> structure is defined as follow:</p>
<pre><code class="language-c">struct Field {
    u1 type;
    u1 info[];
};
</code></pre>
<p>Each field entry must begin with a 1-byte <code>tag</code> indicating the
kind of this field. The contents of the <code>info</code> array vary with the value of tag.</p>
<p>The valid tags and their values are listed in <a href="binary_file/field_and_struct.html#field-tags">Field tags</a>. Each tag byte must be
followed by two or more bytes giving information about the specific field. The
format of the additional information varies with the <code>tag</code> value (see <a href="binary_file/field_and_struct.html#field-variants">Field Variants</a>).</p>
<h3><a class="header" href="#field-tags" id="field-tags">Field tags</a></h3>
<table><thead><tr><th align="center">Field type</th><th align="center">value</th><th align="center">length of the <code>info</code> array</th></tr></thead><tbody>
<tr><td align="center">FIELD_var</td><td align="center">1</td><td align="center"><code>sizeof(FieldVar)</code></td></tr>
<tr><td align="center">FIELD_fn</td><td align="center">2</td><td align="center"><code>sizeof(FieldFn)</code></td></tr>
</tbody></table>
<h3><a class="header" href="#field-variants" id="field-variants">Field variants</a></h3>
<p>A field can be a variable or a function. Each has a different
binary representation.</p>
<h4><a class="header" href="#fieldvar" id="fieldvar">FieldVar</a></h4>
<pre><code class="language-c">struct FieldVar {
    u2 name_index;
};
</code></pre>
<p>The value of the <code>name_index</code> item must be a valid index into the <code>string_pool</code> table.
The <code>string_pool</code> entry at that index represents the field name.</p>
<h4><a class="header" href="#fieldfn" id="fieldfn">FieldFn</a></h4>
<pre><code class="language-c">struct FieldFn {
    u2 name_index;
    u2 block_count;
    CodeBlock block[block_count];
};
</code></pre>
<p>The items of the <code>FieldFn</code> structure are the following:</p>
<h5><a class="header" href="#name_index" id="name_index">name_index</a></h5>
<p>The value of the <code>name_index</code> item must be a valid index into the <code>string_pool</code> table.
The <code>string_pool</code> entry at that index represents the field name.</p>
<p>Name that begins with a '&lt;' ('\u003c') is Epoch VM reserved field name.
For detailed information about reserved name, please see <a href="binary_file/../runtime/reserved_names.html">Reserved Names</a>.</p>
<h5><a class="header" href="#block_count" id="block_count">block_count</a></h5>
<p>The value of the <code>block_count</code> item is equal to the number of entries in the <code>block</code> table.
A <code>block</code> index is considered valid if it is in the range <code>[0, block_count)</code>.</p>
<p>A function must at least have one block (the <code>block_count</code> is always greater than 0).
In run-time, the first block of a function is equal to <code>block[0]</code>.</p>
<h5><a class="header" href="#block" id="block">block</a></h5>
<p>A block refers to a <strong>Basic Block</strong> of the function's <em>Control Flow Graph</em>,
and it is defined as:</p>
<pre><code class="language-c">struct CodeBlock {
    u2 next_block;
    u2 code_length;
    u1 code[code_length];
};
</code></pre>
<h6><a class="header" href="#next_block" id="next_block">next_block</a></h6>
<p>The value of the <code>next_block</code> item must be a valid index into the <code>block</code> table,
indicating the block that will be executed when this block ends.</p>
<h6><a class="header" href="#code_length" id="code_length">code_length</a></h6>
<p>The value of the <code>code_length</code> indicates the length of the <code>code</code> array.</p>
<h6><a class="header" href="#code" id="code">code[]</a></h6>
<p>The <code>code</code> array gives the actual bytes of Epoch Virtual Machine code
that implement the function.</p>
<p>The detailed constraints on the contents of the code array are extensive and are
given in <a href="binary_file/../instruction/00-format-description.html">Instructions</a>.</p>
<h2><a class="header" href="#struct" id="struct">Struct</a></h2>
<p>A <code>Struct</code> structure is defined as follow:</p>
<pre><code class="language-c">struct Struct {
    u2 name_index;
    u2 field_count;
    Field field[field_count];
};
</code></pre>
<p>The items of the <code>Struct</code> structure are the following:</p>
<h3><a class="header" href="#name_index-1" id="name_index-1">name_index</a></h3>
<p>The value of the <code>name_index</code> item must be a valid index into the <code>string_pool</code> table.
The <code>string_pool</code> entry at that index represents the field name.</p>
<h3><a class="header" href="#field_count" id="field_count">field_count</a></h3>
<p>The value of the <code>field_count</code> item is equal to the number of entries in the <code>field</code> table.
A <code>field</code> index is considered valid if it is in the range <code>[0, field_count)</code>.</p>
<h3><a class="header" href="#field-1" id="field-1">field</a></h3>
<p>The <code>field</code> is a table of structures representing various field defined in this struct.
A <code>Field</code> can be a function or a variable.
The format of <code>Field</code> structure is described in <a href="binary_file/field_and_struct.html#field"><strong>Field</strong></a>.</p>
<p>The <code>field</code> table is indexed from <code>0</code> to <code>field_count - 1</code></p>
<h1><a class="header" href="#runtime" id="runtime">Runtime</a></h1>
<p>In this chapter, we will standardize:</p>
<ul>
<li>Object model</li>
<li>Stack frame of a function</li>
<li>Threads</li>
<li>Coroutines</li>
</ul>
<h1><a class="header" href="#reserved-name" id="reserved-name">Reserved Name</a></h1>
<p>Reserved names are some identifiers that are used in special cases.
A reserved name always begins with a '&lt;' ('\u003c').</p>
<p>Epoch VM has the following reserved names:</p>
<h2><a class="header" href="#ctor" id="ctor">&lt;ctor&gt;</a></h2>
<p>This name is only used as a field name which indicates that
the field named <code>&lt;ctor&gt;</code> is a constructor function.</p>
<h2><a class="header" href="#main" id="main">&lt;main&gt;</a></h2>
<p>This name is only used as a field name which indicates that
the field name <code>&lt;main&gt;</code> is the entrance function of a epoch file.</p>
<h1><a class="header" href="#instruction" id="instruction">Instruction</a></h1>
<p>In this chapter, we will standardize:</p>
<ul>
<li>Instructions</li>
<li>Ways that we handle malformed instructions</li>
</ul>
<h1><a class="header" href="#format-of-instruction-descriptions" id="format-of-instruction-descriptions">Format of Instruction Descriptions</a></h1>
<p>Epoch Virtual Machine instructions are represented in this chapter by entries of the
form shown below, in alphabetical order and each beginning on a new page.</p>
<p>Here an example starts:</p>
<hr />
<h2><a class="header" href="#mnemonic" id="mnemonic">mnemonic</a></h2>
<h3><a class="header" href="#operation" id="operation">Operation</a></h3>
<p>Short description of the instruction</p>
<h3><a class="header" href="#format" id="format">Format</a></h3>
<table><thead><tr><th align="center">mnemonic</th></tr></thead><tbody>
<tr><td align="center">operand1</td></tr>
<tr><td align="center">operand2</td></tr>
<tr><td align="center">...</td></tr>
</tbody></table>
<h3><a class="header" href="#forms" id="forms">Forms</a></h3>
<p>mnemonic = opcode</p>
<h3><a class="header" href="#operand-stack" id="operand-stack">Operand Stack</a></h3>
<pre><code>..., value1, value2 -&gt;
..., value3
</code></pre>
<h3><a class="header" href="#description" id="description">Description</a></h3>
<p>A longer description detailing constraints on operand stack
contents or constant pool entries, the operation performed, the type
of the results, etc.</p>
<h3><a class="header" href="#run-time-exceptions" id="run-time-exceptions">Run-time Exceptions</a></h3>
<p>If any run-time exceptions can be thrown by the execution of an
instruction, they are set off one to a line, in the order in which they
must be thrown.
Other than the run-time exceptions, if any, listed
for an instruction, that instruction must not throw any run-time
exceptions except for instances of <code>VirtualMachineError</code>.</p>
<h3><a class="header" href="#notes" id="notes">Notes</a></h3>
<p>Comments not strictly part of the specification of an instruction
are set aside as notes at the end of the description.</p>
<hr />
<p>Here the example ends.</p>
<h2><a class="header" href="#detailed-explanation" id="detailed-explanation">Detailed Explanation</a></h2>
<h3><a class="header" href="#mnemonic-and-opcode" id="mnemonic-and-opcode">mnemonic and opcode</a></h3>
<p>Each cell in the instruction format diagram represents a single <strong>8-bit byte</strong>. The
instruction's mnemonic is its name. Its opcode is its numeric representation and is
given in both decimal and hexadecimal forms. Only the numeric representation is
actually present in the Epoch Virtual Machine code in a class file.</p>
<h3><a class="header" href="#operands" id="operands">&quot;Operands&quot;</a></h3>
<p>Keep in mind that there are &quot;operands&quot; generated at compile time and embedded
within Epoch Virtual Machine instructions, as well as &quot;operands&quot; calculated at run
time and supplied on the operand stack. Although they are supplied from several
different areas, all these operands represent the same thing: values to be operated
upon by the Epoch Virtual Machine instruction being executed.</p>
<p>By implicitly taking many of its operands from its operand stack, rather than representing them
explicitly in its compiled code as additional operand bytes, register numbers, etc.,
the Epoch Virtual Machine's code stays compact.</p>
<h3><a class="header" href="#instruction-family" id="instruction-family">Instruction Family</a></h3>
<p>Some instructions are presented as members of a family of related instructions
sharing a single description, format, and operand stack diagram. As such, a family
of instructions includes several opcodes and opcode mnemonics; only the family
mnemonic appears in the instruction format diagram, and a separate forms line
lists all member mnemonics and opcodes.
For example, the Forms line for the <code>const16_&lt;l&gt;</code> family of instructions,
giving mnemonic and opcode information for the two instructions in that family
(<code>const16_0</code> and <code>const16_1</code>), is</p>
<pre><code>const16_0 = 9 (0x9)
const16_1 = 10 (0xa)
</code></pre>
<h3><a class="header" href="#operand-stack-diagram" id="operand-stack-diagram">Operand Stack Diagram</a></h3>
<p>In the description of the Epoch Virtual Machine instructions, the effect of an
instruction's execution on the operand stack of the current frame is represented textually,
with the stack growing from left to right and each value represented separately. Thus,</p>
<pre><code>..., value1, value2 -&gt;
..., result
</code></pre>
<p>shows an operation that begins by having <code>value2</code> on top of the operand stack with
<code>value1</code> just beneath it.</p>
<p>As a result of the execution of the instruction, <code>value1</code> and <code>value2</code> are popped
from the operand stack and replaced by <code>result</code> value, which has been calculated
by the instruction. The remainder of the operand stack, represented
by an ellipsis (...), is unaffected by the instruction's execution.</p>
<p>Each value regardless of theirs' type are equally represented by a single entry
on the operand stack.</p>
<h2><a class="header" href="#array_load" id="array_load">array_load</a></h2>
<h3><a class="header" href="#operation-1" id="operation-1">Operation</a></h3>
<p>Load an value from an array.</p>
<h3><a class="header" href="#format-1" id="format-1">Format</a></h3>
<table><thead><tr><th align="center">array_load</th></tr></thead><tbody>
</tbody></table>
<h3><a class="header" href="#forms-1" id="forms-1">Forms</a></h3>
<pre><code>array_load =
</code></pre>
<h3><a class="header" href="#operand-stack-1" id="operand-stack-1">Operand Stack</a></h3>
<pre><code>..., array, index -&gt;
..., value
</code></pre>
<h3><a class="header" href="#description-1" id="description-1">Description</a></h3>
<p>The <code>array</code> must refer to an array. The <code>index</code> must be of
type number. Both <code>array</code> and <code>index</code> are popped from the operand
stack. The value in the component of the array at index
is retrieved and pushed onto the operand stack.</p>
<h3><a class="header" href="#run-time-exceptions-1" id="run-time-exceptions-1">Run-time Exceptions</a></h3>
<h3><a class="header" href="#notes-1" id="notes-1">Notes</a></h3>
<h2><a class="header" href="#array_load-1" id="array_load-1">array_load</a></h2>
<h3><a class="header" href="#operation-2" id="operation-2">Operation</a></h3>
<p>Load an value from an array.</p>
<h3><a class="header" href="#format-2" id="format-2">Format</a></h3>
<table><thead><tr><th align="center">array_load</th></tr></thead><tbody>
</tbody></table>
<h3><a class="header" href="#forms-2" id="forms-2">Forms</a></h3>
<pre><code>array_load =
</code></pre>
<h3><a class="header" href="#operand-stack-2" id="operand-stack-2">Operand Stack</a></h3>
<pre><code>..., array, index -&gt;
..., value
</code></pre>
<h3><a class="header" href="#description-2" id="description-2">Description</a></h3>
<p>The <code>array</code> must refer to an array. The <code>index</code> must be of
type number. Both <code>array</code> and <code>index</code> are popped from the operand
stack. The value in the component of the array at index
is retrieved and pushed onto the operand stack.</p>
<h3><a class="header" href="#run-time-exceptions-2" id="run-time-exceptions-2">Run-time Exceptions</a></h3>
<h3><a class="header" href="#notes-2" id="notes-2">Notes</a></h3>
<h2><a class="header" href="#array_store" id="array_store">array_store</a></h2>
<h3><a class="header" href="#operation-3" id="operation-3">Operation</a></h3>
<p>Store an value to an array.</p>
<h3><a class="header" href="#format-3" id="format-3">Format</a></h3>
<table><thead><tr><th align="center">array_store</th></tr></thead><tbody>
</tbody></table>
<h3><a class="header" href="#forms-3" id="forms-3">Forms</a></h3>
<pre><code>array_store =
</code></pre>
<h3><a class="header" href="#operand-stack-3" id="operand-stack-3">Operand Stack</a></h3>
<pre><code>..., array, index, value -&gt;
...
</code></pre>
<h3><a class="header" href="#description-3" id="description-3">Description</a></h3>
<p>The <code>array</code> must refer to an array. The <code>index</code> must be of
type number. The <code>value</code> is of type any.
The <code>array</code>, <code>index</code> and <code>value</code> are popped from the operand
stack.
The <code>value</code> is stored as the component of the <code>array</code> at <code>index</code>.</p>
<h3><a class="header" href="#run-time-exceptions-3" id="run-time-exceptions-3">Run-time Exceptions</a></h3>
<h3><a class="header" href="#notes-3" id="notes-3">Notes</a></h3>
<h2><a class="header" href="#const8" id="const8">const8</a></h2>
<h3><a class="header" href="#operation-4" id="operation-4">Operation</a></h3>
<p>Push byte.</p>
<h3><a class="header" href="#format-4" id="format-4">Format</a></h3>
<table><thead><tr><th align="center">const8</th></tr></thead><tbody>
<tr><td align="center">byte</td></tr>
</tbody></table>
<h3><a class="header" href="#forms-4" id="forms-4">Forms</a></h3>
<pre><code>const8 =
</code></pre>
<h3><a class="header" href="#operand-stack-4" id="operand-stack-4">Operand Stack</a></h3>
<pre><code>... -&gt;
..., value
</code></pre>
<h3><a class="header" href="#description-4" id="description-4">Description</a></h3>
<p>The immediate <code>byte</code> is <strong>sign-extended</strong> to an <code>int</code> value.
That <code>value</code> is pushed onto the operand stack.</p>
<h3><a class="header" href="#run-time-exceptions-4" id="run-time-exceptions-4">Run-time Exceptions</a></h3>
<h3><a class="header" href="#notes-4" id="notes-4">Notes</a></h3>
<h2><a class="header" href="#const8_n" id="const8_n">const8_&lt;n&gt;</a></h2>
<h3><a class="header" href="#operation-5" id="operation-5">Operation</a></h3>
<p>Push byte.</p>
<h3><a class="header" href="#format-5" id="format-5">Format</a></h3>
<table><thead><tr><th align="center">const8_&lt;n&gt;</th></tr></thead><tbody>
</tbody></table>
<h3><a class="header" href="#forms-5" id="forms-5">Forms</a></h3>
<pre><code>const8_m1 =
const8_0 =
const8_1 =
const8_2 =
const8_3 =
const8_4 =
const8_5 =
</code></pre>
<h3><a class="header" href="#operand-stack-5" id="operand-stack-5">Operand Stack</a></h3>
<pre><code>... -&gt;
..., &lt;n&gt;
</code></pre>
<h3><a class="header" href="#description-5" id="description-5">Description</a></h3>
<p>Push the <code>int</code> constant <em>&lt;n&gt;</em> (-1, 0, 1, 2, 3, 4, 5)
onto the operand stack.</p>
<h3><a class="header" href="#run-time-exceptions-5" id="run-time-exceptions-5">Run-time Exceptions</a></h3>
<h3><a class="header" href="#notes-5" id="notes-5">Notes</a></h3>
<h2><a class="header" href="#const32" id="const32">const32</a></h2>
<h3><a class="header" href="#operation-6" id="operation-6">Operation</a></h3>
<p>Push int32.</p>
<h3><a class="header" href="#format-6" id="format-6">Format</a></h3>
<table><thead><tr><th align="center">const32</th></tr></thead><tbody>
<tr><td align="center">byte1</td></tr>
<tr><td align="center">byte2</td></tr>
<tr><td align="center">byte3</td></tr>
<tr><td align="center">byte4</td></tr>
</tbody></table>
<h3><a class="header" href="#forms-6" id="forms-6">Forms</a></h3>
<p>const32 =</p>
<h3><a class="header" href="#operand-stack-6" id="operand-stack-6">Operand Stack</a></h3>
<pre><code>...-&gt;
..., value
</code></pre>
<h3><a class="header" href="#description-6" id="description-6">Description</a></h3>
<p>Push the <code>value</code> (constructed by <code>byte1 &lt;&lt; 24 | byte2 &lt;&lt; 16 | byte3 &lt;&lt; 8 | byte4</code>)
on to the operand stack.</p>
<h3><a class="header" href="#run-time-exceptions-6" id="run-time-exceptions-6">Run-time Exceptions</a></h3>
<h3><a class="header" href="#notes-6" id="notes-6">Notes</a></h3>
<h2><a class="header" href="#const_null" id="const_null">const_null</a></h2>
<h3><a class="header" href="#operation-7" id="operation-7">Operation</a></h3>
<p>Push null.</p>
<h3><a class="header" href="#format-7" id="format-7">Format</a></h3>
<table><thead><tr><th align="center">const_null</th></tr></thead><tbody>
</tbody></table>
<h3><a class="header" href="#forms-7" id="forms-7">Forms</a></h3>
<p>const_null =</p>
<h3><a class="header" href="#operand-stack-7" id="operand-stack-7">Operand Stack</a></h3>
<pre><code>...-&gt;
..., null
</code></pre>
<h3><a class="header" href="#description-7" id="description-7">Description</a></h3>
<p>Push the <code>null</code> value onto the operand stack.</p>
<h3><a class="header" href="#run-time-exceptions-7" id="run-time-exceptions-7">Run-time Exceptions</a></h3>
<h3><a class="header" href="#notes-7" id="notes-7">Notes</a></h3>
<h2><a class="header" href="#const_num" id="const_num">const_num</a></h2>
<h3><a class="header" href="#operation-8" id="operation-8">Operation</a></h3>
<p>Push double.</p>
<h3><a class="header" href="#format-8" id="format-8">Format</a></h3>
<table><thead><tr><th align="center">const_num</th></tr></thead><tbody>
<tr><td align="center">indexbyte1</td></tr>
<tr><td align="center">indexbyte2</td></tr>
</tbody></table>
<h3><a class="header" href="#forms-8" id="forms-8">Forms</a></h3>
<p>const_num =</p>
<h3><a class="header" href="#operand-stack-8" id="operand-stack-8">Operand Stack</a></h3>
<pre><code>...-&gt;
..., value
</code></pre>
<h3><a class="header" href="#description-8" id="description-8">Description</a></h3>
<p>Push the <code>value</code> (stored in <strong>Constant Number Pool</strong> indexed by <code>index</code> (constructed by <code>indexbyte1 &lt;&lt; 8 | indexbyte2</code>))
onto the operand stack.</p>
<h3><a class="header" href="#run-time-exceptions-8" id="run-time-exceptions-8">Run-time Exceptions</a></h3>
<h3><a class="header" href="#notes-8" id="notes-8">Notes</a></h3>
<h2><a class="header" href="#const_string" id="const_string">const_string</a></h2>
<h3><a class="header" href="#operation-9" id="operation-9">Operation</a></h3>
<p>Push string.</p>
<h3><a class="header" href="#format-9" id="format-9">Format</a></h3>
<table><thead><tr><th align="center">const_string</th></tr></thead><tbody>
<tr><td align="center">indexbyte1</td></tr>
<tr><td align="center">indexbyte2</td></tr>
</tbody></table>
<h3><a class="header" href="#forms-9" id="forms-9">Forms</a></h3>
<p>const_string =</p>
<h3><a class="header" href="#operand-stack-9" id="operand-stack-9">Operand Stack</a></h3>
<pre><code>...-&gt;
..., value
</code></pre>
<h3><a class="header" href="#description-9" id="description-9">Description</a></h3>
<p>Push the <code>value</code> (stored in <strong>Constant String Pool</strong> indexed by <code>index</code> (constructed by <code>indexbyte1 &lt;&lt; 8 | indexbyte2</code>))
onto the operand stack.</p>
<h3><a class="header" href="#run-time-exceptions-9" id="run-time-exceptions-9">Run-time Exceptions</a></h3>
<h3><a class="header" href="#notes-9" id="notes-9">Notes</a></h3>
<h2><a class="header" href="#dup" id="dup">dup</a></h2>
<h3><a class="header" href="#operation-10" id="operation-10">Operation</a></h3>
<p>Duplicate stack top.</p>
<h3><a class="header" href="#format-10" id="format-10">Format</a></h3>
<table><thead><tr><th align="center">dup</th></tr></thead><tbody>
</tbody></table>
<h3><a class="header" href="#forms-10" id="forms-10">Forms</a></h3>
<p>dup =</p>
<h3><a class="header" href="#operand-stack-10" id="operand-stack-10">Operand Stack</a></h3>
<pre><code>..., value -&gt;
..., value, value
</code></pre>
<h3><a class="header" href="#description-10" id="description-10">Description</a></h3>
<p>Duplicate the stack top element.</p>
<h3><a class="header" href="#run-time-exceptions-10" id="run-time-exceptions-10">Run-time Exceptions</a></h3>
<h3><a class="header" href="#notes-10" id="notes-10">Notes</a></h3>
<h2><a class="header" href="#field_load" id="field_load">field_load</a></h2>
<h3><a class="header" href="#operation-11" id="operation-11">Operation</a></h3>
<p>Load object field.</p>
<h3><a class="header" href="#format-11" id="format-11">Format</a></h3>
<table><thead><tr><th align="center">field_load</th></tr></thead><tbody>
<tr><td align="center">indexbyte1</td></tr>
<tr><td align="center">indexbyte2</td></tr>
</tbody></table>
<h3><a class="header" href="#forms-11" id="forms-11">Forms</a></h3>
<pre><code>field_load =
</code></pre>
<h3><a class="header" href="#operand-stack-11" id="operand-stack-11">Operand Stack</a></h3>
<pre><code>..., object -&gt;
..., field
</code></pre>
<h3><a class="header" href="#description-11" id="description-11">Description</a></h3>
<p>Push the <code>field</code> of the <code>object</code> onto the operand stack.
The <code>index</code> (constructed by <code>indexbyte1 &lt;&lt; 8 | indexbyte2</code>) must be a valid <strong>Constant Field Info Pool</strong> index.</p>
<h3><a class="header" href="#run-time-exceptions-11" id="run-time-exceptions-11">Run-time Exceptions</a></h3>
<h3><a class="header" href="#notes-11" id="notes-11">Notes</a></h3>
<h2><a class="header" href="#field_store" id="field_store">field_store</a></h2>
<h3><a class="header" href="#operation-12" id="operation-12">Operation</a></h3>
<p>Store object field</p>
<h3><a class="header" href="#format-12" id="format-12">Format</a></h3>
<table><thead><tr><th align="center">field_store</th></tr></thead><tbody>
<tr><td align="center">indexbyte1</td></tr>
<tr><td align="center">indexbyte2</td></tr>
</tbody></table>
<h3><a class="header" href="#forms-12" id="forms-12">Forms</a></h3>
<pre><code>field_store =
</code></pre>
<h3><a class="header" href="#operand-stack-12" id="operand-stack-12">Operand Stack</a></h3>
<pre><code>..., object, value -&gt;
...
</code></pre>
<h3><a class="header" href="#description-12" id="description-12">Description</a></h3>
<p>Store the <code>value</code> to <code>object</code> field (described by <code>index</code> (constructed by <code>indexbyte1 &lt;&lt; 8 | indexbyte2</code>)).
The <code>index</code> must be a valid <strong>Constant Field Info Pool</strong> index.</p>
<h3><a class="header" href="#run-time-exceptions-12" id="run-time-exceptions-12">Run-time Exceptions</a></h3>
<h3><a class="header" href="#notes-12" id="notes-12">Notes</a></h3>
<h2><a class="header" href="#if_cmp" id="if_cmp">if_&lt;cmp&gt;</a></h2>
<h3><a class="header" href="#operation-13" id="operation-13">Operation</a></h3>
<p>Compare and jump.</p>
<h3><a class="header" href="#format-13" id="format-13">Format</a></h3>
<table><thead><tr><th align="center">if_&lt;cmp&gt;</th></tr></thead><tbody>
<tr><td align="center">branchbyte1</td></tr>
<tr><td align="center">branchbyte1</td></tr>
</tbody></table>
<h3><a class="header" href="#forms-13" id="forms-13">Forms</a></h3>
<pre><code>if_eq =
if_ne =
if_lt =
if_le =
if_gt =
if_ge =
</code></pre>
<h3><a class="header" href="#operand-stack-13" id="operand-stack-13">Operand Stack</a></h3>
<pre><code>..., lhs, rhs -&gt;
...
</code></pre>
<h3><a class="header" href="#description-13" id="description-13">Description</a></h3>
<p>Both <code>lhs</code> and <code>rhs</code> are popped from the operand stack and compared.
The results of the comparison are as follows:</p>
<ul>
<li><code>if_eq</code> succeeds if and only if <code>lhs == rhs</code></li>
<li><code>if_ne</code> succeeds if and only if <code>lhs != rhs</code></li>
<li><code>if_lt</code> succeeds if and only if <code>lhs &lt; rhs</code></li>
<li><code>if_le</code> succeeds if and only if <code>lhs &lt;= rhs</code></li>
<li><code>if_gt</code> succeeds if and only if <code>lhs &gt; rhs</code></li>
<li><code>if_ge</code> succeeds if and only if <code>lhs &gt;= rhs</code></li>
</ul>
<p>If the comparison succeeds, the <strong>unsigned</strong> <code>branchbyte1</code> and
<code>branchbyte2</code> are used to construct a <strong>signed 16-bit offset</strong>, where
the offset is calculated to be <code>(branchbyte1 &lt;&lt; 8) | branchbyte2</code>.</p>
<p>Execution then proceeds at that offset from the address of the
opcode of this <code>if_&lt;cmp&gt;</code> instruction. The target address
must be that of an opcode of an instruction within the function that
contains this <code>if_&lt;cmp&gt;</code> instruction.</p>
<p>Otherwise, if the comparison fails, execution proceeds at
the address of the instruction following this <code>if_&lt;cmp&gt;</code>
instruction.</p>
<h3><a class="header" href="#run-time-exceptions-13" id="run-time-exceptions-13">Run-time Exceptions</a></h3>
<h2><a class="header" href="#invoke" id="invoke">invoke</a></h2>
<h3><a class="header" href="#operation-14" id="operation-14">Operation</a></h3>
<p>Invoke function.</p>
<h3><a class="header" href="#format-14" id="format-14">Format</a></h3>
<table><thead><tr><th align="center">invoke</th></tr></thead><tbody>
</tbody></table>
<h3><a class="header" href="#forms-14" id="forms-14">Forms</a></h3>
<pre><code>invoke =
</code></pre>
<h3><a class="header" href="#operand-stack-14" id="operand-stack-14">Operand Stack</a></h3>
<pre><code>..., [arg1, [arg2...]], function -&gt;
..., [result]
</code></pre>
<h3><a class="header" href="#description-14" id="description-14">Description</a></h3>
<p>Invoke <code>function</code> with args (<code>arg1</code> .. <code>argN</code>).</p>
<p>The <code>result</code> is the function return value if and only if the function doesn't return void.</p>
<h3><a class="header" href="#run-time-exceptions-14" id="run-time-exceptions-14">Run-time Exceptions</a></h3>
<h3><a class="header" href="#notes-13" id="notes-13">Notes</a></h3>
<p>For more information about function invocation, please see
the runtime section about <strong>Calling Conventions</strong>.</p>
<h2><a class="header" href="#invoke_ctor" id="invoke_ctor">invoke_ctor</a></h2>
<h3><a class="header" href="#operation-15" id="operation-15">Operation</a></h3>
<p>Invoke constructor on an object.</p>
<h3><a class="header" href="#format-15" id="format-15">Format</a></h3>
<table><thead><tr><th align="center">invoke_ctor</th></tr></thead><tbody>
</tbody></table>
<h3><a class="header" href="#forms-15" id="forms-15">Forms</a></h3>
<pre><code>invoke_ctor =
</code></pre>
<h3><a class="header" href="#operand-stack-15" id="operand-stack-15">Operand Stack</a></h3>
<pre><code>..., [arg1, [arg2...]], object -&gt;
...
</code></pre>
<h3><a class="header" href="#description-15" id="description-15">Description</a></h3>
<p>Invoke constructor function on <code>object</code> with args (<code>arg1</code> .. <code>argN</code>).</p>
<h3><a class="header" href="#run-time-exceptions-15" id="run-time-exceptions-15">Run-time Exceptions</a></h3>
<h3><a class="header" href="#notes-14" id="notes-14">Notes</a></h3>
<h2><a class="header" href="#jump" id="jump">jump</a></h2>
<h3><a class="header" href="#operation-16" id="operation-16">Operation</a></h3>
<p>Unconditionally jump.</p>
<h3><a class="header" href="#format-16" id="format-16">Format</a></h3>
<table><thead><tr><th align="center">jump</th></tr></thead><tbody>
<tr><td align="center">branchbyte1</td></tr>
<tr><td align="center">branchbyte2</td></tr>
</tbody></table>
<h3><a class="header" href="#forms-16" id="forms-16">Forms</a></h3>
<pre><code>jump =
</code></pre>
<h3><a class="header" href="#description-16" id="description-16">Description</a></h3>
<p>The <strong>unsigned</strong> <code>branchbyte1</code> and <code>branchbyte2</code> are used to
construct a <strong>signed 16-bit offset</strong>, where the offset is calculated
to be <code>(branchbyte1 &lt;&lt; 8) | branchbyte2</code>.</p>
<p>Execution then proceeds at that offset from the address of the
opcode of this <code>jump</code> instruction. The target address
must be that of an opcode of an instruction within the function that
contains this <code>jump</code> instruction.</p>
<h3><a class="header" href="#run-time-exceptions-16" id="run-time-exceptions-16">Run-time Exceptions</a></h3>
<h3><a class="header" href="#notes-15" id="notes-15">Notes</a></h3>
<h2><a class="header" href="#jump_cmp" id="jump_cmp">jump_&lt;cmp&gt;</a></h2>
<h3><a class="header" href="#operation-17" id="operation-17">Operation</a></h3>
<p>Compare and jump.</p>
<h3><a class="header" href="#format-17" id="format-17">Format</a></h3>
<table><thead><tr><th align="center">jump_&lt;cmp&gt;</th></tr></thead><tbody>
<tr><td align="center">branchbyte1</td></tr>
<tr><td align="center">branchbyte2</td></tr>
</tbody></table>
<h3><a class="header" href="#forms-17" id="forms-17">Forms</a></h3>
<pre><code>jump_eq =
jump_ne =
jump_lt =
jump_le =
jump_gt =
jump_ge =
</code></pre>
<h3><a class="header" href="#operand-stack-16" id="operand-stack-16">Operand Stack</a></h3>
<pre><code>..., value -&gt;
...
</code></pre>
<h3><a class="header" href="#description-17" id="description-17">Description</a></h3>
<p>The <code>value</code> is popped from the operand stack and compared.
The results of the comparison are as follows:</p>
<ul>
<li><code>jump_eq</code> succeeds if and only if <code>value == 0</code></li>
<li><code>jump_ne</code> succeeds if and only if <code>value != 0</code></li>
<li><code>jump_lt</code> succeeds if and only if <code>value &lt; 0</code></li>
<li><code>jump_le</code> succeeds if and only if <code>value &lt;= 0</code></li>
<li><code>jump_gt</code> succeeds if and only if <code>value &gt; 0</code></li>
<li><code>jump_ge</code> succeeds if and only if <code>value &gt;= 0</code></li>
</ul>
<p>If the comparison succeeds, the <strong>unsigned</strong> <code>branchbyte1</code> and
<code>branchbyte2</code> are used to construct a <strong>signed 16-bit offset</strong>, where
the offset is calculated to be <code>(branchbyte1 &lt;&lt; 8) | branchbyte2</code>.</p>
<p>Execution then proceeds at that offset from the address of the
opcode of this <code>jump_&lt;cmp&gt;</code> instruction. The target address
must be that of an opcode of an instruction within the function that
contains this <code>jump_&lt;cmp&gt;</code> instruction.</p>
<p>Otherwise, if the comparison fails, execution proceeds at
the address of the instruction following this <code>jump_&lt;cmp&gt;</code>
instruction.</p>
<h3><a class="header" href="#run-time-exceptions-17" id="run-time-exceptions-17">Run-time Exceptions</a></h3>
<h2><a class="header" href="#jump_null" id="jump_null">jump_null</a></h2>
<h3><a class="header" href="#operation-18" id="operation-18">Operation</a></h3>
<p>Jump if null.</p>
<h3><a class="header" href="#format-18" id="format-18">Format</a></h3>
<table><thead><tr><th align="center">jump_null</th></tr></thead><tbody>
<tr><td align="center">branchbyte1</td></tr>
<tr><td align="center">branchbyte2</td></tr>
</tbody></table>
<h3><a class="header" href="#forms-18" id="forms-18">Forms</a></h3>
<p>jump_null =</p>
<h3><a class="header" href="#operand-stack-17" id="operand-stack-17">Operand Stack</a></h3>
<pre><code>..., value -&gt;
...
</code></pre>
<h3><a class="header" href="#description-18" id="description-18">Description</a></h3>
<p>The <code>value</code> is popped from the operand stack and compared.
The results of the comparison are as follows:</p>
<ul>
<li><code>jump_null</code> succeeds if and only if <code>value == null</code></li>
</ul>
<p>If the comparison succeeds, the <strong>unsigned</strong> <code>branchbyte1</code> and
<code>branchbyte2</code> are used to construct a <strong>signed 16-bit offset</strong>, where
the offset is calculated to be <code>(branchbyte1 &lt;&lt; 8) | branchbyte2</code>.</p>
<p>Execution then proceeds at that offset from the address of the
opcode of this <code>jump_&lt;cmp&gt;</code> instruction. The target address
must be that of an opcode of an instruction within the function that
contains this <code>jump_&lt;cmp&gt;</code> instruction.</p>
<p>Otherwise, if the comparison fails, execution proceeds at
the address of the instruction following this <code>jump_&lt;cmp&gt;</code>
instruction.</p>
<h3><a class="header" href="#run-time-exceptions-18" id="run-time-exceptions-18">Run-time Exceptions</a></h3>
<h2><a class="header" href="#local_load" id="local_load">local_load</a></h2>
<h3><a class="header" href="#operation-19" id="operation-19">Operation</a></h3>
<p>Load local variable.</p>
<h3><a class="header" href="#format-19" id="format-19">Format</a></h3>
<table><thead><tr><th align="center">local_load</th></tr></thead><tbody>
<tr><td align="center">indexbyte1</td></tr>
<tr><td align="center">indexbyte2</td></tr>
</tbody></table>
<h3><a class="header" href="#forms-19" id="forms-19">Forms</a></h3>
<pre><code>local_load =
</code></pre>
<h3><a class="header" href="#operand-stack-18" id="operand-stack-18">Operand Stack</a></h3>
<pre><code>...-&gt;
..., value
</code></pre>
<h3><a class="header" href="#description-19" id="description-19">Description</a></h3>
<p>Push local variable <code>index</code> (constructed by <code>indexbyte1 &lt;&lt; 8 | indexbyte2</code>) onto the operand stack.</p>
<h3><a class="header" href="#run-time-exceptions-19" id="run-time-exceptions-19">Run-time Exceptions</a></h3>
<h3><a class="header" href="#notes-16" id="notes-16">Notes</a></h3>
<h2><a class="header" href="#local_store" id="local_store">local_store</a></h2>
<h3><a class="header" href="#operation-20" id="operation-20">Operation</a></h3>
<p>Store local variable.</p>
<h3><a class="header" href="#format-20" id="format-20">Format</a></h3>
<table><thead><tr><th align="center">local_store</th></tr></thead><tbody>
<tr><td align="center">indexbyte1</td></tr>
<tr><td align="center">indexbyte2</td></tr>
</tbody></table>
<h3><a class="header" href="#forms-20" id="forms-20">Forms</a></h3>
<pre><code>local_store =
</code></pre>
<h3><a class="header" href="#operand-stack-19" id="operand-stack-19">Operand Stack</a></h3>
<pre><code>..., value -&gt;
...
</code></pre>
<h3><a class="header" href="#description-20" id="description-20">Description</a></h3>
<p>Store the <code>value</code> to local variable <code>index</code> (constructed by <code>indexbyte1 &lt;&lt; 8 | indexbyte2</code>).</p>
<h3><a class="header" href="#run-time-exceptions-20" id="run-time-exceptions-20">Run-time Exceptions</a></h3>
<h3><a class="header" href="#notes-17" id="notes-17">Notes</a></h3>
<h2><a class="header" href="#new" id="new">new</a></h2>
<h3><a class="header" href="#operation-21" id="operation-21">Operation</a></h3>
<p>New object.</p>
<h3><a class="header" href="#format-21" id="format-21">Format</a></h3>
<table><thead><tr><th align="center">new</th></tr></thead><tbody>
<tr><td align="center">indexbyte1</td></tr>
<tr><td align="center">indexbyte2</td></tr>
</tbody></table>
<h3><a class="header" href="#forms-21" id="forms-21">Forms</a></h3>
<pre><code>new =
</code></pre>
<h3><a class="header" href="#operand-stack-20" id="operand-stack-20">Operand Stack</a></h3>
<pre><code>...-&gt;
..., object
</code></pre>
<h3><a class="header" href="#description-21" id="description-21">Description</a></h3>
<p>Allocate an object from garbage-collected heap with type described by <code>index</code> (constructed by <code>indexbyte1 &lt;&lt; 8 | indexbyte2</code>).
Object fields are initialized with their <strong>default values</strong>.
The <code>index</code> must be a valid <strong>Constant Type Info Pool</strong> index.</p>
<h3><a class="header" href="#run-time-exceptions-21" id="run-time-exceptions-21">Run-time Exceptions</a></h3>
<h3><a class="header" href="#notes-18" id="notes-18">Notes</a></h3>
<h2><a class="header" href="#nop" id="nop">nop</a></h2>
<h3><a class="header" href="#operation-22" id="operation-22">Operation</a></h3>
<p>No-operation.</p>
<h3><a class="header" href="#format-22" id="format-22">Format</a></h3>
<table><thead><tr><th align="center">nop</th></tr></thead><tbody>
</tbody></table>
<h3><a class="header" href="#forms-22" id="forms-22">Forms</a></h3>
<pre><code>nop = 0 (0x0)
</code></pre>
<h3><a class="header" href="#description-22" id="description-22">Description</a></h3>
<p>Do nothing.</p>
<h2><a class="header" href="#pop" id="pop">pop</a></h2>
<h3><a class="header" href="#operation-23" id="operation-23">Operation</a></h3>
<p>Discard the stack top.</p>
<h3><a class="header" href="#format-23" id="format-23">Format</a></h3>
<table><thead><tr><th align="center">pop</th></tr></thead><tbody>
</tbody></table>
<h3><a class="header" href="#forms-23" id="forms-23">Forms</a></h3>
<pre><code>pop =
</code></pre>
<h3><a class="header" href="#operand-stack-21" id="operand-stack-21">Operand Stack</a></h3>
<pre><code>..., value -&gt;
...
</code></pre>
<h3><a class="header" href="#description-23" id="description-23">Description</a></h3>
<p>Pop and discard the stack top element.</p>
<h3><a class="header" href="#run-time-exceptions-22" id="run-time-exceptions-22">Run-time Exceptions</a></h3>
<h3><a class="header" href="#notes-19" id="notes-19">Notes</a></h3>
<h2><a class="header" href="#return" id="return">return</a></h2>
<h3><a class="header" href="#operation-24" id="operation-24">Operation</a></h3>
<p>Return with result.</p>
<h3><a class="header" href="#format-24" id="format-24">Format</a></h3>
<table><thead><tr><th align="center">return</th></tr></thead><tbody>
</tbody></table>
<h3><a class="header" href="#forms-24" id="forms-24">Forms</a></h3>
<p>return =</p>
<h3><a class="header" href="#operand-stack-22" id="operand-stack-22">Operand Stack</a></h3>
<pre><code>..., value -&gt;
...
</code></pre>
<h3><a class="header" href="#description-24" id="description-24">Description</a></h3>
<p>Return <code>value</code> from this function.</p>
<h3><a class="header" href="#run-time-exceptions-23" id="run-time-exceptions-23">Run-time Exceptions</a></h3>
<h2><a class="header" href="#return_void" id="return_void">return_void</a></h2>
<h3><a class="header" href="#operation-25" id="operation-25">Operation</a></h3>
<p>Just return.</p>
<h3><a class="header" href="#format-25" id="format-25">Format</a></h3>
<table><thead><tr><th align="center">return_void</th></tr></thead><tbody>
</tbody></table>
<h3><a class="header" href="#forms-25" id="forms-25">Forms</a></h3>
<p>return =</p>
<h3><a class="header" href="#operand-stack-23" id="operand-stack-23">Operand Stack</a></h3>
<pre><code>...-&gt;
...
</code></pre>
<h3><a class="header" href="#description-25" id="description-25">Description</a></h3>
<p>Return from current function.</p>
<h3><a class="header" href="#run-time-exceptions-24" id="run-time-exceptions-24">Run-time Exceptions</a></h3>
<h2><a class="header" href="#swap" id="swap">swap</a></h2>
<h3><a class="header" href="#operation-26" id="operation-26">Operation</a></h3>
<p>Swap the stack top 2 elements.</p>
<h3><a class="header" href="#format-26" id="format-26">Format</a></h3>
<table><thead><tr><th align="center">swap</th></tr></thead><tbody>
</tbody></table>
<h3><a class="header" href="#forms-26" id="forms-26">Forms</a></h3>
<p>swap =</p>
<h3><a class="header" href="#operand-stack-24" id="operand-stack-24">Operand Stack</a></h3>
<pre><code>..., value1, value2 -&gt;
..., value2, value1
</code></pre>
<h3><a class="header" href="#description-26" id="description-26">Description</a></h3>
<p>Swap the stack top 2 elements.</p>
<h3><a class="header" href="#run-time-exceptions-25" id="run-time-exceptions-25">Run-time Exceptions</a></h3>
<h3><a class="header" href="#notes-20" id="notes-20">Notes</a></h3>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
